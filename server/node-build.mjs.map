{"version":3,"file":"node-build.mjs","sources":["../../server/routes/demo.ts","../../server/routes/payment.ts","../../server/index.ts","../../server/node-build.ts"],"sourcesContent":["import { RequestHandler } from \"express\";\nimport { DemoResponse } from \"@shared/api\";\n\nexport const handleDemo: RequestHandler = (req, res) => {\n  const response: DemoResponse = {\n    message: \"Hello from Express server\",\n  };\n  res.status(200).json(response);\n};\n","import { Router } from 'express';\r\nimport Razorpay from 'razorpay';\r\nimport crypto from 'crypto';\r\n\r\nconst router = Router();\r\n\r\n// Initialize Razorpay instance\r\nconst razorpay = new Razorpay({\r\n  key_id: process.env.RAZORPAY_KEY_ID || 'rzp_test_RbYFbZvXenhjVA',\r\n  key_secret: process.env.RAZORPAY_KEY_SECRET || 'jETTTowzDmG21TFG0O1wFF4d',\r\n});\r\n\r\n// Create order endpoint\r\nrouter.post('/create-order', async (req, res) => {\r\n  try {\r\n    const { amount, currency = 'INR', receipt } = req.body;\r\n    \r\n    const options = {\r\n      amount: amount * 100, // Razorpay expects amount in paise\r\n      currency,\r\n      receipt: receipt || `receipt_${Date.now()}`,\r\n    };\r\n    \r\n    const order = await razorpay.orders.create(options);\r\n    res.json({ success: true, order });\r\n  } catch (error) {\r\n    console.error('Error creating order:', error);\r\n    res.status(500).json({ success: false, message: 'Failed to create order' });\r\n  }\r\n});\r\n\r\n// Verify payment endpoint\r\nrouter.post('/verify-payment', async (req, res) => {\r\n  try {\r\n    const { razorpay_order_id, razorpay_payment_id, razorpay_signature } = req.body;\r\n    \r\n    // Create the expected signature\r\n    const expectedSignature = crypto\r\n      .createHmac('sha256', process.env.RAZORPAY_KEY_SECRET || 'jETTTowzDmG21TFG0O1wFF4d')\r\n      .update(razorpay_order_id + '|' + razorpay_payment_id)\r\n      .digest('hex');\r\n    \r\n    // Compare signatures\r\n    const isSignatureValid = expectedSignature === razorpay_signature;\r\n    \r\n    if (isSignatureValid) {\r\n      res.json({ \r\n        success: true, \r\n        orderId: razorpay_order_id, \r\n        paymentId: razorpay_payment_id, \r\n        signature: razorpay_signature \r\n      });\r\n    } else {\r\n      res.status(400).json({ \r\n        success: false, \r\n        message: 'Invalid payment signature' \r\n      });\r\n    }\r\n  } catch (error) {\r\n    console.error('Error verifying payment:', error);\r\n    res.status(500).json({ success: false, message: 'Failed to verify payment' });\r\n  }\r\n});\r\n\r\nexport default router;","import \"dotenv/config\";\nimport express from \"express\";\nimport cors from \"cors\";\nimport { handleDemo } from \"./routes/demo\";\nimport paymentRoutes from \"./routes/payment\";\n\nexport function createServer() {\n  const app = express();\n\n  // Middleware\n  app.use(cors());\n  app.use(express.json());\n  app.use(express.urlencoded({ extended: true }));\n\n  // Example API routes\n  app.get(\"/api/ping\", (_req, res) => {\n    const ping = process.env.PING_MESSAGE ?? \"ping\";\n    res.json({ message: ping });\n  });\n\n  app.get(\"/api/demo\", handleDemo);\n  \n  // Payment routes\n  app.use(\"/api/payment\", paymentRoutes);\n\n  return app;\n}","import path from \"path\";\nimport { createServer } from \"./index\";\nimport * as express from \"express\";\n\nconst app = createServer();\nconst port = process.env.PORT || 3000;\n\n// In production, serve the built SPA files\nconst __dirname = import.meta.dirname;\nconst distPath = path.join(__dirname, \"../spa\");\n\n// Serve static files\napp.use(express.static(distPath));\n\n// Handle React Router - serve index.html for all non-API routes\napp.get(\"*\", (req, res) => {\n  // Don't serve index.html for API routes\n  if (req.path.startsWith(\"/api/\") || req.path.startsWith(\"/health\")) {\n    return res.status(404).json({ error: \"API endpoint not found\" });\n  }\n\n  res.sendFile(path.join(distPath, \"index.html\"));\n});\n\napp.listen(port, () => {\n  console.log(`ðŸš€ Fusion Starter server running on port ${port}`);\n  console.log(`ðŸ“± Frontend: http://localhost:${port}`);\n  console.log(`ðŸ”§ API: http://localhost:${port}/api`);\n});\n\n// Graceful shutdown\nprocess.on(\"SIGTERM\", () => {\n  console.log(\"ðŸ›‘ Received SIGTERM, shutting down gracefully\");\n  process.exit(0);\n});\n\nprocess.on(\"SIGINT\", () => {\n  console.log(\"ðŸ›‘ Received SIGINT, shutting down gracefully\");\n  process.exit(0);\n});\n"],"names":["app","express","paymentRoutes"],"mappings":"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"}